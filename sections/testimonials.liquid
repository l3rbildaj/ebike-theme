{{ 'section-testimonials.css' | asset_url | stylesheet_tag }}
{% if section.blocks.size > 1 %}
  <script src="{{ 'split-type.min.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'testimonials.js' | asset_url }}" defer="defer"></script>
{% endif %}

{%- style -%}
  {% render 'section-padding' %}
  {% render 'section-margin' %}
{%- endstyle -%}

<div dir="ltr" class="testimonials color-{{ section.settings.color_scheme }} background section-{{ section.id }}-padding{% if section.blocks.size <= 1 %} testimonials--no-slider{% endif %}{% if section.settings.mobile_slider_layout_type == 'visible_overflow'  %} testimonials--visible-overflow{% endif %}">
  <div
    class="{%- if section.settings.layout == 'with_image' -%}container{%- endif -%}"
  >
    {% if section.settings.layout == 'with_image' %}
      {% render 'heading-group',
        section: section,
        class: 'collections-list__header',
        text_align: section.settings.text_align
      %}
    {% else %}
      <div class="testimonials-heading-container container">
        {% render 'heading-group',
          section: section,
          class: 'collections-list__header',
          text_align: section.settings.text_align
        %}
      </div>
    {% endif %}

    <div class="testimonials-content content">
      {% if section.blocks.size > 0 %}
        {% if section.settings.layout == 'with_image' %}
          <div class="testimonials-images-slider swiper{% if section.settings.mobile_slider_layout_type == 'visible_overflow'  %} testimonials-images-slider--visible-overflow{% endif %}" dir="ltr">
            <div class="testimonials-images-slider-wrapper swiper-wrapper">
              {% for block in section.blocks %}
                <div
                  class="testimonials-images-slider-slide testimonials-images-slider-slide--{{ section.settings.aspect_ratio }} swiper-slide "
                  {{ block.shopify_attributes }}
                >
                  {% if block.settings.image %}
                    {% liquid
                      assign img_styles = 'object-fit: ' | append: section.settings.object_fit

                      assign image_loading = 'lazy'

                      if section.index == 1 and forloop.index == 1
                        assign image_loading = 'eager'
                      endif

                      assign settings_aspect_ratio = 1

                      if section.settings.aspect_ratio == 'landscape'
                        assign settings_aspect_ratio = 1.77
                      elsif section.settings.aspect_ratio == 'portrait'
                        assign settings_aspect_ratio = 0.8
                      endif

                      assign calc_ratio = 1

                      if block.settings.image.aspect_ratio > settings_aspect_ratio and section.settings.object_fit == 'cover'
                        assign calc_ratio = block.settings.image.aspect_ratio | divided_by: settings_aspect_ratio
                      endif
                    %}
                    {% capture img_sizes %}
                    '(min-width: 1440px) calc(516px * {{ calc_ratio }}), (min-width: 1360px) calc(36vw * {{ calc_ratio }}), (min-width: 1200px) calc(37vw * {{ calc_ratio }}), (min-width: 750px) calc(44vw * {{ calc_ratio }}), (min-width: 576px) 95vw, calc(91vw * {{ calc_ratio }})'
                  {% endcapture %}
                    {{
                      block.settings.image
                      | image_url: width: block.settings.image.width
                      | image_tag:
                        width: block.settings.image.width,
                        height: block.settings.image.height,
                        widths: '360, 535, 600, 720, 940, 1066, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 3200, 3400, 3600, 3800',
                        sizes: img_sizes,
                        class: 'testimonials-images-slider-image',
                        style: img_styles,
                        loading: image_loading
                    }}
                  {% else %}
                    {% assign image_index = forloop.index | minus: 1 | modulo: 3 | plus: 1 %}
                    {{
                      'hero-apparel-'
                      | append: image_index
                      | placeholder_svg_tag: 'placeholder-svg placeholder-svg--filled'
                    }}
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <div class="testimonials-main{% if section.settings.layout == 'without_image' %} testimonials-main-without-images{% endif %}">
          {% if section.blocks.size > 1 %}
            <div class="testimonials-slider-buttons no-js-hidden{% if section.settings.layout == 'without_image' %} container{% endif %}">
              <button class="testimonials-slider-button testimonials-slider-button--prev" aria-label="Previous slide">
                {% render 'icon-btn-arrow' %}
              </button>
              <button class="testimonials-slider-button testimonials-slider-button--next" aria-label="Next slide">
                {% render 'icon-btn-arrow' %}
              </button>
            </div>
          {% endif %}

          {% if section.settings.slider_heading != blank or section.settings.slider_text != blank %}
            {% if section.settings.layout == 'without_image' %}
              <div class="container">
                <div class="testimonials-main-header">
                  {% if section.settings.slider_heading != blank %}
                    <h2 class="testimonials-main-header__heading subtitle">
                      {{- section.settings.slider_heading | escape -}}
                    </h2>
                  {% endif %}
                  {% if section.settings.slider_text != blank %}
                    <p class="testimonials-main-header__text body-small">
                      {{- section.settings.slider_text | escape -}}
                    </p>
                  {% endif %}
                </div>
              </div>
            {% else %}
              <div class="testimonials-main-header">
                {% if section.settings.slider_heading != blank %}
                  <h2 class="testimonials-main-header__heading subtitle">
                    {{ section.settings.slider_heading | escape }}
                  </h2>
                {% endif %}
                {% if section.settings.slider_text != blank %}
                  <p class="testimonials-main-header__text body-small">
                    {{ section.settings.slider_text | escape }}
                  </p>
                {% endif %}
              </div>
            {% endif %}
          {% endif %}

          <div class="testimonials-slider swiper{% if section.settings.layout == 'without_image' %} testimonials-slider--no-images{% endif %}{% if section.settings.mobile_slider_layout_type == 'visible_overflow'  %} testimonials-slider--visible-overflow{% endif %}">
            <div class="testimonials-slider-wrapper swiper-wrapper">
              {% for block in section.blocks %}
                <div class="testimonials-slider-slide swiper-slide" {{ block.shopify_attributes }}>
                  {% if section.settings.layout == 'with_image' %}
                    <div class="testimonials-slider-slide__image-wrapper testimonials-slider-slide__image-wrapper--{{ section.settings.aspect_ratio }}">
                      {% if block.settings.image %}
                        {% liquid
                          assign img_styles = 'object-fit: ' | append: section.settings.object_fit

                          assign settings_aspect_ratio = 1

                          if section.settings.aspect_ratio == 'landscape'
                            assign settings_aspect_ratio = 1.77
                          elsif section.settings.aspect_ratio == 'portrait'
                            assign settings_aspect_ratio = 0.8
                          endif

                          assign calc_ratio = 1

                          if block.settings.image.aspect_ratio > settings_aspect_ratio and section.settings.object_fit == 'cover'
                            assign calc_ratio = block.settings.image.aspect_ratio | divided_by: settings_aspect_ratio
                          endif

                          assign image_loading = 'lazy'

                          if section.index == 1 and forloop.index == 1
                            assign image_loading = 'eager'
                          endif
                        %}
                        {%- capture img_sizes -%}
                          (min-width: 1440px) calc(516px * {{ calc_ratio }}), (min-width: 1360px) calc(36vw * {{ calc_ratio }}), (min-width: 1200px) calc(37vw * {{ calc_ratio }}), (min-width: 750px) calc(44vw * {{ calc_ratio }}), (min-width: 576px) 95vw, calc(91vw * {{ calc_ratio }})
                        {%- endcapture -%}
                        {{
                          block.settings.image
                          | image_url: width: block.settings.image.width
                          | image_tag:
                            width: block.settings.image.width,
                            height: block.settings.image.height,
                            widths: '360, 535, 600, 720, 940, 1066, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 3200, 3400, 3600, 3800',
                            sizes: img_sizes,
                            class: 'testimonials-slider-slide__image',
                            style: img_styles
                        }}
                      {% else %}
                        {% assign image_index = forloop.index | minus: 1 | modulo: 3 | plus: 1 %}
                        {{
                          'hero-apparel-'
                          | append: image_index
                          | placeholder_svg_tag: 'placeholder-svg placeholder-svg--filled'
                        }}
                      {% endif %}
                    </div>
                  {% endif %}
                  <div class="testimonials-slider-slide__rating">
                    {% assign rating = block.settings.rating %}
                    {% for i in (1..rating) %}
                      {% render 'icon-star' %}
                    {% endfor %}
                  </div>
                  {%- if block.settings.slide_text != blank -%}
                    <div class="testimonials-slider-slide__text {{ section.settings.slide_text_size }}">
                      {{- block.settings.slide_text | escape -}}
                    </div>
                  {%- endif -%}
                  {%- if block.settings.slide_author != blank or block.settings.product != blank -%}
                    <div class="testimonials-slider-slide__bottom">
                      {%- if block.settings.slide_author != blank -%}
                        <span class="testimonials-slider-slide__author body-normal">
                          {{- block.settings.slide_author | escape -}}
                        </span>
                      {%- endif -%}
                      {%- if block.settings.product != blank -%}
                        {% render 'button',
                          btn_link: block.settings.product.url,
                          btn_label: block.settings.product.title,
                          btn_style: 'tertiary',
                          btn_arrow: block.settings.button_arrow,
                          class: 'testimonials-slider-slide__button'
                        %}
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
        <div class="testimonials-cursor">
          {% render 'icon-btn-arrow' %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "t:sections.testimonials.name",
  "tag": "section",
  "class": "testimonials-section",
  "enabled_on": {
    "templates": ["*"]
  },
  "settings": [
    {
      "type": "header",
      "content": "t:sections.testimonials.settings.header__1.content"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "default": "background-1",
      "label": "t:sections.all.color_scheme.label"
    },
    {
      "type": "select",
      "id": "layout",
      "options": [
        {
          "value": "with_image",
          "label": "t:sections.testimonials.settings.layout.options__1.label"
        },
        {
          "value": "without_image",
          "label": "t:sections.testimonials.settings.layout.options__2.label"
        }
      ],
      "default": "with_image",
      "label": "t:sections.testimonials.settings.layout.label"
    },
    {
      "type": "select",
      "id": "mobile_slider_layout_type",
      "options": [
        {
          "value": "visible_overflow",
          "label": "t:sections.all.mobile_slider_layout_type.options__1.label"
        },
        {
          "value": "with_arrows",
          "label": "t:sections.all.mobile_slider_layout_type.options__2.label"
        }
      ],
      "default": "visible_overflow",
      "label": "t:sections.all.mobile_slider_layout_type.label"
    },
    {
      "type": "header",
      "content": "t:sections.testimonials.settings.header__2.content"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:sections.all.subheading.label"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "t:sections.all.heading.label"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h3",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.options__2.label"
        }
      ],
      "default": "h2",
      "label": "t:sections.all.heading_size.label"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "t:sections.all.heading_tag.label",
      "default": "h2",
      "options": [
        {
          "value": "h1",
          "label": "H1"
        },
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        },
        {
          "value": "h4",
          "label": "H4"
        },
        {
          "value": "h5",
          "label": "H5"
        },
        {
          "value": "h6",
          "label": "H6"
        },
        {
          "value": "div",
          "label": "div"
        },
        {
          "value": "p",
          "label": "p"
        },
        {
          "value": "span",
          "label": "span"
        }
      ]
    },
    {
      "type": "inline_richtext",
      "id": "description",
      "label": "t:sections.all.text.label"
    },
    {
      "type": "text_alignment",
      "id": "text_align",
      "label": "t:sections.all.text_align.label",
      "default": "center"
    },
    {
      "type": "header",
      "content": "t:sections.testimonials.settings.header__3.content"
    },
    {
      "type": "text",
      "id": "slider_heading",
      "label": "t:sections.testimonials.settings.slider_heading.label",
      "default": "t:sections.testimonials.settings.slider_heading.default"
    },
    {
      "type": "text",
      "id": "slider_text",
      "label": "t:sections.testimonials.settings.slider_text.label",
      "default": "t:sections.testimonials.settings.slider_text.default"
    },
    {
      "type": "select",
      "id": "slide_text_size",
      "label": "t:sections.testimonials.settings.slide_text_size.label",
      "options": [
        {
          "value": "h3",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "h4",
          "label": "t:sections.all.heading_size.options__4.label"
        },
        {
          "value": "h5",
          "label": "t:sections.all.heading_size.options__5.label"
        }
      ],
      "default": "h3"
    },
    {
      "type": "header",
      "content": "t:sections.testimonials.settings.header__4.content"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "options": [
        {
          "value": "landscape",
          "label": "t:sections.all.card.image_ratio_2.options__1.label"
        },
        {
          "value": "portrait",
          "label": "t:sections.all.card.image_ratio_2.options__2.label"
        },
        {
          "value": "square",
          "label": "t:sections.all.card.image_ratio_2.options__3.label"
        },
        {
          "value": "adapt",
          "label": "t:sections.all.card.image_ratio_2.options__4.label"
        }
      ],
      "default": "portrait",
      "label": "t:sections.all.card.image_ratio_2.label"
    },
    {
      "type": "select",
      "id": "object_fit",
      "options": [
        {
          "value": "contain",
          "label": "t:sections.all.card.image_fit.options__1.label"
        },
        {
          "value": "cover",
          "label": "t:sections.all.card.image_fit.options__2.label"
        }
      ],
      "default": "cover",
      "label": "t:sections.all.card.image_fit.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.section-padding.header.content"
    },
    {
      "type": "select",
      "id": "padding_top",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-padding.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-padding.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-padding.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-padding.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-padding.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-padding.options__6.label"
        }
      ],
      "default": "xl",
      "label": "t:sections.all.section-padding.padding_top.label"
    },
    {
      "type": "select",
      "id": "padding_bottom",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-padding.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-padding.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-padding.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-padding.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-padding.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-padding.options__6.label"
        }
      ],
      "default": "xl",
      "label": "t:sections.all.section-padding.padding_bottom.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.section-margin.header.content"
    },
    {
      "type": "select",
      "id": "margin_top",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-margin.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-margin.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-margin.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-margin.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-margin.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-margin.options__6.label"
        }
      ],
      "default": "no-indent",
      "label": "t:sections.all.section-margin.margin_top.label"
    },
    {
      "type": "select",
      "id": "margin_bottom",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-margin.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-margin.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-margin.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-margin.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-margin.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-margin.options__6.label"
        }
      ],
      "default": "no-indent",
      "label": "t:sections.all.section-margin.margin_bottom.label"
    }
  ],
  "blocks": [
    {
      "type": "testimonials_slide",
      "name": "t:sections.testimonials.blocks.testimonials_slide.name",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.testimonials.blocks.testimonials_slide.settings.image.label",
          "info": "t:sections.testimonials.blocks.testimonials_slide.settings.image.info"
        },
        {
          "type": "range",
          "id": "rating",
          "min": 0,
          "max": 5,
          "step": 1,
          "default": 5,
          "label": "t:sections.testimonials.blocks.testimonials_slide.settings.rating.label"
        },
        {
          "type": "textarea",
          "id": "slide_text",
          "label": "t:sections.testimonials.blocks.testimonials_slide.settings.slide_text.label",
          "default": "t:sections.testimonials.blocks.testimonials_slide.settings.slide_text.default"
        },

        {
          "type": "text",
          "id": "slide_author",
          "label": "t:sections.testimonials.blocks.testimonials_slide.settings.slide_author.label",
          "default": "t:sections.testimonials.blocks.testimonials_slide.settings.slide_author.default"
        },
        {
          "type": "product",
          "id": "product",
          "label": "t:sections.testimonials.blocks.testimonials_slide.settings.product.label"
        },
        {
          "type": "checkbox",
          "id": "button_arrow",
          "default": true,
          "label": "t:sections.testimonials.blocks.testimonials_slide.settings.button_arrow.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.testimonials.name",
      "blocks": [
        {
          "type": "testimonials_slide"
        },
        {
          "type": "testimonials_slide"
        },
        {
          "type": "testimonials_slide"
        }
      ]
    }
  ]
}
{% endschema %}
