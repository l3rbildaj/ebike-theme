{{ 'section-countdown.css' | asset_url | stylesheet_tag }}

<script src="{{ 'countdown.js' | asset_url }}" defer="defer"></script>

{% liquid
  assign timezone = 'now' | date: '%Z' | plus: 0 | append: ''

  if timezone.size > 1
    assign timezone = 'now' | date: '%Z' | divided_by: 100 | times: 3600.0 | plus: 1800
  else
    assign timezone = 'now' | date: '%Z' | minus: 1 | times: 3600.0
  endif

  assign date_merge = section.settings.date_picker | append: '-' | append: section.settings.time_picker | append: ':00'
  assign date_now = 'now' | date: '%s' | minus: 0
  assign date_settings = date_merge | date: '%s' | minus: 0

  if date_now < date_settings
    assign distance = date_settings | minus: date_now
    assign days = distance | divided_by: 3600 | divided_by: 24 | floor | append: ''
    assign hours = distance | modulo: 86400 | divided_by: 3600 | floor | append: ''
    assign minutes = distance | modulo: 3600 | divided_by: 60 | floor | append: ''
    assign seconds = distance | modulo: 60 | floor | append: ''
  else
    assign days = '00'
    assign hours = '00'
    assign minutes = '00'
    assign seconds = '00'
  endif
%}

{% liquid
  if section.settings.countdown_block_font == 'normal'
    assign countdown_block_font = 'h4'
  elsif section.settings.countdown_block_font == 'medium'
    assign countdown_block_font = 'h3'
  else
    assign countdown_block_font = 'h2'
  endif
%}

{%- style -%}
  {% render 'section-padding' %}
  {% render 'section-margin' %}
{%- endstyle -%}

<div class="countdown__outer section-{{ section.id }}-padding color-{{ section.settings.color_scheme }} background">
  <countdown-timer
    class="countdown js-countdown js-countdown-{{ section.id }}"
    data-date="{{ section.settings.date_picker }}"
    data-time="{{ section.settings.time_picker }}"
    data-completed="{{ section.settings.completed_countdown }}"
    data-loop-timer="{{ section.settings.enable_loop_timer }}"
    data-loop-interval="{{ section.settings.interval_loop_timer }}"
    data-mock-timer="{{ section.settings.mock_timer }}"
  >
    <div class="countdown__container gap--{{ section.settings.gap }} order--{{ section.settings.content_order }} container">
      <div class="countdown__timer color-{{ section.settings.content_color_scheme }} {% if section.settings.enable_image == false or section.settings.image == blank %} only-timer {% endif %}{% if section.settings.animate_on_scroll %} animate-on-scroll{% endif %}">
        <div class="countdown__wrapper align--{{ section.settings.content_alignment }}">
          {%- if section.settings.date_picker != blank -%}
            <div class="countdown__main">
              <div class="countdown__block">
                <div class="countdown__block_num">
                  <span
                    class="countdown_block_days {{ countdown_block_font }}"
                  >
                    {% if days.size > 1 %}
                      {{ days }}
                    {% else %}
                      {{ 0 | append: days }}
                    {% endif %}
                  </span>
                  <span class="countdown_block_mark">{{- 'general.countdown.days' | t }}</span>
                </div>
              </div>
              <div class="countdown__block">
                <div class="countdown__block_num">
                  <span
                    class="countdown_block_hours {{ countdown_block_font }}"
                  >
                    {% if hours.size > 1 %}
                      {{ hours }}
                    {% else %}
                      {{ 0 | append: hours }}
                    {% endif %}
                  </span>
                  <span class="countdown_block_mark">{{- 'general.countdown.hours' | t -}}</span>
                </div>
              </div>
              <div class="countdown__block">
                <div class="countdown__block_num">
                  <span
                    class="countdown_block_minutes {{ countdown_block_font }}"
                  >
                    {% if minutes.size > 1 %}
                      {{ minutes }}
                    {% else %}
                      {{ 0 | append: minutes }}
                    {% endif %}
                  </span>
                  <span class="countdown_block_mark">{{- 'general.countdown.minutes' | t -}}</span>
                </div>
              </div>
              <div class="countdown__block">
                <div class="countdown__block_num">
                  <span
                    class="countdown_block_seconds {{ countdown_block_font }}"
                  >
                    {% if seconds.size > 1 %}
                      {{ seconds }}
                    {% else %}
                      {{ 0 | append: seconds }}
                    {% endif %}
                  </span>
                  <span class="countdown_block_mark">{{- 'general.countdown.seconds' | t -}}</span>
                </div>
              </div>
            </div>
          {%- endif -%}
          {% if section.settings.countdown_heading %}
            <div class="countdown__end-info align--{{ section.settings.content_alignment }}">
              <h3 class="h3 countdown__end-info-text ">
                {{ section.settings.countdown_heading }}
              </h3>
            </div>
          {% endif %}

          {% if section.settings.subheading != blank
            or section.settings.heading != blank
            or section.settings.description != blank
            or section.settings.show_link
          %}
            <div class="countdown__content align--{{ section.settings.content_alignment }}">
              {%- if section.settings.subheading != blank -%}
                <div class="countdown__subheading subtitle">
                  {{- section.settings.subheading | strip_newlines -}}
                </div>
              {% endif %}
              {%- if section.settings.heading != blank -%}
                {% assign heading_tag = section.settings.heading_tag %}
                <{{ heading_tag }} class="countdown__heading {{ section.settings.heading_size }} title">
                  {{- section.settings.heading | strip_newlines -}}
                </{{ heading_tag }}>
              {%- endif -%}
              {%- if section.settings.description != blank -%}
                <div class="countdown__text description">
                  {{ section.settings.description | strip_newlines }}
                </div>
              {%- endif -%}
              {%- if section.settings.show_link -%}
                {% render 'button',
                  btn_label: section.settings.button_label,
                  btn_style: section.settings.button_style,
                  btn_link: section.settings.button_link,
                  btn_arrow: section.settings.button_arrow,
                  enable_arrow: section.settings.button_arrow,
                  class: 'countdown__button'
                %}
              {%- endif -%}
            </div>
          {% endif %}
        </div>
      </div>
      {%- if section.settings.enable_image == true and section.settings.image != blank -%}
        {% liquid
          assign fetch_priority = 'auto'
          if section.index == 1
            assign fetch_priority = 'high'
          endif
        %}
        {% liquid
          assign calc_ratio = 1

          if section.settings.image.aspect_ratio > 1
            assign calc_ratio = section.settings.image.aspect_ratio | round: 2
          endif
        %}

        {% capture image_sizes %} 
          (min-width: 1440px) calc(524px * {{ calc_ratio }}), (min-width: 1200px) calc(36.24vw * {{ calc_ratio }}), (min-width: 990px) calc(39,24vw * {{ calc_ratio }}), (min-width: 576px) calc(95.5vw * {{ calc_ratio }}),  calc(92vw * {{ calc_ratio }})
        {% endcapture %}

        <div class="countdown__image color-{{ section.settings.content_color_scheme }}{% if section.settings.animate_on_scroll %} animate-on-scroll{% endif %}">
          {{
            section.settings.image
            | image_url: width: section.settings.image.width
            | image_tag:
              loading: 'lazy',
              class: 'countdown__image-image',
              fetchpriority: fetch_priority,
              sizes: image_sizes,
              widths: '246, 493, 600, 713, 823, 990, 1100, 1206, 1346, 1426, 1646, 1946, 2200, 2400, 2600, 2800, 3000, 3200, 3400, 3600, 3900'
          }}

          <span
            class="countdown__image-overlay"
            style="background-color: rgba(var(--color-overlay), {{ section.settings.overlay_opacity | divided_by: 100.0 }})"
          ></span>
        </div>
      {%- endif -%}
    </div>
  </countdown-timer>
</div>

{% schema %}
{
  "name": "t:sections.countdown.name",
  "tag": "section",
  "class": "countdown-section spaced-section",
  "enabled_on": {
    "templates": ["*"]
  },
  "settings": [
    {
			"type": "checkbox",
			"id": "mock_timer",
			"default": true,
			"label": "t:sections.countdown.settings.mock_timer.label",
			"info": "t:sections.countdown.settings.mock_timer.info"
		},
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "default": "background-1",
      "label": "t:sections.all.color_scheme.label"
    },
    {
      "type": "color_scheme",
      "id": "content_color_scheme",
      "default": "background-3",
      "label": "t:sections.countdown.settings.content_color_scheme.label"
    },
    {
      "type": "select",
      "id": "gap",
      "label": "t:sections.countdown.settings.gap.label",
      "info": "t:sections.countdown.settings.gap.info",
      "options": [
        {
          "value": "small",
          "label": "t:sections.countdown.settings.gap.options__3.label"
        },
        {
          "value": "medium",
          "label": "t:sections.countdown.settings.gap.options__2.label"
        },
        {
          "value": "large",
          "label": "t:sections.countdown.settings.gap.options__1.label"
        }
      ],
      "default": "small"
    },
    {
      "type": "select",
      "id": "content_order",
      "label": "t:sections.countdown.settings.content_order.label",
      "options": [
        {
          "value": "countdown",
          "label": "t:sections.countdown.settings.content_order.options__2.label"
        },
        {
          "value": "image",
          "label": "t:sections.countdown.settings.content_order.options__1.label"
        }
      ],
      "default": "countdown"
    },
    {
      "type": "checkbox",
      "id": "animate_on_scroll",
      "label": "t:sections.all.animate_on_scroll.label",
      "info": "t:sections.all.animate_on_scroll.info",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.countdown.settings.header__1.content"
    },
    {
      "type": "text",
      "id": "date_picker",
      "default": "2025-12-01",
      "info": "YYYY-MM-DD",
      "label": "t:sections.countdown.settings.date_picker.label"
    },
    {
      "type": "text",
      "id": "time_picker",
      "default": "00:00",
      "info": "hh:mm",
      "label": "t:sections.countdown.settings.time_picker.label"
    },
    {
      "type": "select",
      "id": "countdown_block_font",
      "options": [
        {
          "value": "normal",
          "label": "t:sections.countdown.settings.countdown_block_font.options__3.label"
        },
        {
          "value": "medium",
          "label": "t:sections.countdown.settings.countdown_block_font.options__4.label"
        },
        {
          "value": "large",
          "label": "t:sections.countdown.settings.countdown_block_font.options__2.label"
        }
      ],
      "default": "normal",
      "label": "t:sections.countdown.settings.countdown_block_font.label"
    },

    {
      "type": "select",
      "id": "completed_countdown",
      "options": [
        {
          "value": "hide_section",
          "label": "t:sections.countdown.settings.completed_countdown.options_1.label"
        },
        {
          "value": "show_text",
          "label": "t:sections.countdown.settings.completed_countdown.options_2.label"
        }
      ],
      "default": "show_text",
      "label": "t:sections.countdown.settings.completed_countdown.label"
    },
    {
      "type": "inline_richtext",
      "id": "countdown_heading",
      "label": "t:sections.countdown.settings.countdown_heading.label",
      "default": "t:sections.countdown.settings.countdown_heading.default"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:sections.all.subheading.label"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "t:sections.all.heading.label",
      "default": "t:sections.countdown.settings.heading.default",
      "info": "t:sections.all.heading.info"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h3",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.options__2.label"
        }
      ],
      "default": "h3",
      "label": "t:sections.all.heading_size.label"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "t:sections.all.heading_tag.label",
      "default": "h2",
      "options": [
        {
          "value": "h1",
          "label": "H1"
        },
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        },
        {
          "value": "h4",
          "label": "H4"
        },
        {
          "value": "h5",
          "label": "H5"
        },
        {
          "value": "h6",
          "label": "H6"
        },
        {
          "value": "div",
          "label": "div"
        },
        {
          "value": "p",
          "label": "p"
        },
        {
          "value": "span",
          "label": "span"
        }
      ]
    },
    {
      "type": "inline_richtext",
      "id": "description",
      "label": "t:sections.all.text.label",
      "default": "t:sections.countdown.settings.description.default"
    },
    {
      "type": "checkbox",
      "id": "show_link",
      "default": true,
      "label": "t:sections.all.button.button_show.label"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "t:sections.all.button.button_label.label",
      "default": "t:sections.countdown.settings.button_label.default"
    },
    {
      "type": "select",
      "id": "button_style",
      "options": [
        {
          "value": "primary",
          "label": "t:sections.all.button.button_style.options__1.label"
        },
        {
          "value": "secondary",
          "label": "t:sections.all.button.button_style.options__2.label"
        },
        {
          "value": "tertiary",
          "label": "t:sections.all.button.button_style.options__3.label"
        }
      ],
      "default": "primary",
      "label": "t:sections.all.button.button_style.label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "t:sections.all.button.button_link.label"
    },
    {
      "type": "checkbox",
      "id": "button_arrow",
      "default": true,
      "label": "t:sections.all.button.button_arrow.label"
    },
    {
      "type": "text_alignment",
      "id": "content_alignment",
      "label": "t:sections.countdown.settings.content_alignment.label",
      "default": "center"
    },
    {
      "type": "header",
      "content": "t:sections.countdown.settings.header__2.content"
    },
    {
      "type": "checkbox",
      "id": "enable_image",
      "default": true,
      "label": "t:sections.countdown.settings.enable_image.label"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:sections.countdown.settings.image.label"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "t:sections.all.overlay_opacity.label",
      "default": 0
    },
    {
      "type": "header",
      "content": "t:sections.all.section-padding.header.content"
    },
    {
      "type": "select",
      "id": "padding_top",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-padding.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-padding.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-padding.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-padding.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-padding.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-padding.options__6.label"
        }
      ],
      "default": "no-indent",
      "label": "t:sections.all.section-padding.padding_top.label"
    },
    {
      "type": "select",
      "id": "padding_bottom",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-padding.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-padding.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-padding.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-padding.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-padding.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-padding.options__6.label"
        }
      ],
      "default": "xl",
      "label": "t:sections.all.section-padding.padding_bottom.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.section-margin.header.content"
    },
    {
      "type": "select",
      "id": "margin_top",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-margin.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-margin.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-margin.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-margin.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-margin.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-margin.options__6.label"
        }
      ],
      "default": "no-indent",
      "label": "t:sections.all.section-margin.margin_top.label"
    },
    {
      "type": "select",
      "id": "margin_bottom",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-margin.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-margin.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-margin.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-margin.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-margin.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-margin.options__6.label"
        }
      ],
      "default": "no-indent",
      "label": "t:sections.all.section-margin.margin_bottom.label"
    }
  ],
  "presets": [
    {
      "name": "t:sections.countdown.presets.name"
    }
  ]
}
{% endschema %}
